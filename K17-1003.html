<!doctype html>
<html lang=en-us>

<head>
  <meta charset=utf-8>
  <meta charset=utf-8>
  <meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
  <meta name=robots content="noindex, nofollow"><!--[if IEMobile]><meta http-equiv=cleartype content="on"><![endif]-->
  <title>Exploring the Syntactic Abilities of RNNs with Multi-task Learning - ACL Anthology</title>
  <meta name=generator content="Hugo 0.118.2">
  <link href=/autopr/aclicon.ico rel="shortcut icon" type=image/x-icon>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel=stylesheet href=autopr/css/main.min.b1d14a9a8f6bb9c608ca4de9aad72a6e06945119f97951f2908522dc220e6277.css
    media=screen>
  <link rel=stylesheet href=https://use.fontawesome.com/releases/v5.7.2/css/all.css
    integrity=sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr crossorigin=anonymous>
  <link rel=stylesheet href=autopr/css/academicons.min.css>
  <meta content="Exploring the Syntactic Abilities of RNNs with Multi-task Learning" name=citation_title>
  <meta content="Émile Enguehard" name=citation_author>
  <meta content="Yoav Goldberg" name=citation_author>
  <meta content="Tal Linzen" name=citation_author>
  <meta content="Proceedings of the 21st Conference on Computational Natural Language Learning (CoNLL 2017)"
    name=citation_conference_title>
  <meta content="2017/8" name=citation_publication_date>
  <meta content="https://preview.aclanthology.org/autopr/K17-1003.pdf" name=citation_pdf_url>
  <meta content="3" name=citation_firstpage>
  <meta content="14" name=citation_lastpage>
  <meta content="10.18653/v1/K17-1003" name=citation_doi>
  <meta property="og:title" content="Exploring the Syntactic Abilities of RNNs with Multi-task Learning">
  <meta property="og:image" content="https://preview.aclanthology.org/autopr/thumb/K17-1003.jpg">
  <meta property="og:image:alt" content="First page of paper PDF.">
  <meta property="og:type" content="article">
  <meta property="og:site_name" content="ACL Anthology">
  <meta property="og:url" content="https://aclanthology.org/K17-1003">
  <meta property="og:description"
    content="Émile Enguehard, Yoav Goldberg, Tal Linzen. Proceedings of the 21st Conference on Computational Natural Language Learning (CoNLL 2017). 2017.">
  <link rel=canonical href=https://aclanthology.org/K17-1003>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
  <style>
  .sortable-ghost {
    opacity: 0.4;
  }
  .author-row {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
    align-items: center;
    cursor: grab;
    background: #f8f9fa;
    padding: 0.5rem;
    border: 1px solid #ddd;
    border-radius: 4px;
  }
  .author-row input {
    flex: 1;
  }
  .author-row:active {
    cursor: grabbing;
  }
  .drag-handle {
    cursor: grab;
  }
  .drag-handle:active {
    cursor: grabbing;
  }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-sm navbar-light bg-light bg-gradient-light shadow-sm py-0 mb-3 mb-md-4 mb-xl-5">
    <div id=navbar-container class=container><a class=navbar-brand href= /><img src=/images/acl-logo.svg width=56
        alt="ACL Logo">
      <span class="d-inline pl-2">ACL Anthology</span></a>
      <button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent
        aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
        <span class=navbar-toggler-icon></span></button>
      <div class="collapse navbar-collapse" id=navbarSupportedContent>
        <ul class="navbar-nav flex-grow-1 pr-md-2">
          <li class=nav-item><a class=nav-link href=/autopr/posts />News<span class=sr-only>(current)</span></a></li>
          <li class=nav-item><a class=nav-link href=/autopr/faq />FAQ<span class=sr-only>(current)</span></a></li>
          <li class=nav-item><a class=nav-link href=/autopr/info/corrections />Corrections<span
              class=sr-only>(current)</span></a></li>
          <li class=nav-item><a class=nav-link href=/autopr/info/contrib />Submissions<span
              class=sr-only>(current)</span></a></li>
          <li class=nav-item><a class=nav-link href=https://github.com/acl-org/acl-anthology /><i
              class="fab fa-github pr-1"></i>Github</a></li>
        </ul>
        <form class="form-inline my-2 my-lg-0 flex-nowrap" action=/search/? method=get><input id=acl-search-box
            class="form-control mr-sm-2" name=q type=search placeholder=Search... aria-label=Search>
          <button class="btn btn-outline-primary" type=submit><i class="fas fa-search"></i></button>
        </form>
      </div>
    </div>
  </nav>
  <div role=alert class="alert alert-danger text-center">This is an <b>internal, incomplete preview</b> of a proposed
    change to the ACL Anthology.
    For efficiency reasons, we generate only three BibTeX files per volume, and the preview may be incomplete in other
    ways, or contain mistakes.
    <b>Do not treat this content as an official publication</b>.
  </div>
  <div id=main-container class=container>
    <section id=main>
      <div>
        <h2 id=title><a href=https://preview.aclanthology.org/autopr/K17-1003.pdf>Exploring the Syntactic Abilities of
            <span class=acl-fixed-case>RNN</span>s with Multi-task Learning</a></h2>
        <p class=lead><a href=/autopr/people/e/emile-enguehard />Émile Enguehard</a>,
          <a href=/autopr/people/y/yoav-goldberg />Yoav Goldberg</a>,
          <a href=/autopr/people/t/tal-linzen />Tal Linzen</a>
        </p>
      </div>
      <hr>
<!-- Modal for metadata -->
<!-- NEW -->
<div class="modal fade" id="metadataModal" tabindex="-1" aria-labelledby="metadataModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Correct Metadata for <span id="paperIdSpan"></span></h5>
        <button class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
       </button>
      </div>
      <div class="modal-body">
          <form id="metadataForm">
          <div class="mb-3">
            <label for="paperTitle" class="form-label">
              Title
              <small id="paperTitleHelp" class="form-text text-muted">
                Adjust the title. Retain tags such as &lt;fixed-case&gt;.
              </small>
            </label>
            <input type="text" class="form-control" id="paperTitle">
          </div>
          <div class="mb-3">
            <label class="form-label">
              Authors
              <small id="authorTitleHelp" class="form-text text-muted">
                Here you can modify author names and affiliations and reorder with drag and drop.
              </small>
            </label>
                <div id="authorsContainer" ondrop="dropAuthor(event)" ondragover="allowDrop(event)">
                </div>
                <button type="button" class="btn btn-secondary btn-sm mb-3" onclick="addAuthor()">
                  Add Author
                </button>
          </div>

          <div class="mb-3">
            <label for="paperAbstract" class="form-label">Abstract
              <small id="abstractTitleHelp" class="form-text text-muted">Correct abstract if needed. Retain XML formatting tags such as &lt;tex-math&gt;.</small>
            </label>
            <textarea class="form-control" id="paperAbstract" rows="6"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" onclick="submitMetadataCorrection()">Submit</button>
      </div>
    </div>
  </div>
</div>

      <div class="row acl-paper-details">
        <div class="col col-lg-10 order-2">
          <div class="card bg-light mb-2 mb-lg-3">
            <div class="card-body acl-abstract">
              <h5 class=card-title>Abstract</h5><span>Recent work has explored the syntactic abilities of RNNs using the
                subject-verb agreement task, which diagnoses sensitivity to sentence structure. RNNs performed this task
                well in common cases, but faltered in complex sentences (Linzen et al., 2016). We test whether these
                errors are due to inherent limitations of the architecture or to the relatively indirect supervision
                provided by most agreement dependencies in a corpus. We trained a single RNN to perform both the
                agreement task and an additional task, either CCG supertagging or language modeling. Multi-task training
                led to significantly lower error rates, in particular on complex sentences, suggesting that RNNs have
                the ability to evolve more sophisticated syntactic representations than shown before. We also show that
                easily available agreement training data can improve performance on other syntactic tasks, in particular
                when only a limited amount of training data is available for those tasks. The multi-task paradigm can
                also be leveraged to inject grammatical knowledge into language models.</span>
            </div>
          </div>
          <dl>
            <dt>Anthology ID:</dt>
            <dd>K17-1003</dd>
            <dt>Volume:</dt>
            <dd><a href=/autopr/volumes/K17-1 />Proceedings of the 21st Conference on Computational Natural Language
              Learning (CoNLL 2017)</a></dd>
            <dt>Month:</dt>
            <dd>August</dd>
            <dt>Year:</dt>
            <dd>2017</dd>
            <dt>Address:</dt>
            <dd>Vancouver, Canada</dd>
            <dt>Editors:</dt>
            <dd><a href=/autopr/people/r/roger-levy />Roger Levy</a>,
              <a href=/autopr/people/l/lucia-specia />Lucia Specia</a>
            </dd>
            <dt>Venue:</dt>
            <dd><a href=/autopr/venues/conll />CoNLL</a></dd>
            <dt>SIG:</dt>
            <dd><a href=/autopr/sigs/signll />SIGNLL</a></dd>
            <dt>Publisher:</dt>
            <dd>Association for Computational Linguistics</dd>
            <dt>Note:</dt>
            <dd></dd>
            <dt>Pages:</dt>
            <dd>3–14</dd>
            <dt>Language:</dt>
            <dd></dd>
            <dt>URL:</dt>
            <dd><a href=https://aclanthology.org/K17-1003>https://aclanthology.org/K17-1003</a></dd>
            <dt>DOI:</dt>
            <dd><a href=https://doi.org/10.18653/v1/K17-1003
                title="To the current version of the paper by DOI">10.18653/v1/K17-1003</a></dd>
            <dt class=acl-button-row>Bibkey:</dt>
            <dd class=acl-button-row><button type=button class="btn btn-clipboard-outside btn-secondary btn-sm d-none"
                data-clipboard-target=#citePaperBibkey><i class="far fa-clipboard"></i><span id=citePaperBibkey
                  class="pl-2 text-monospace">enguehard-etal-2017-exploring</span></button></dd>
            <dt>Cite (ACL):</dt>
            <dd><span id=citeACL>Émile Enguehard, Yoav Goldberg, and Tal Linzen. 2017. <a
                  href=https://aclanthology.org/K17-1003>Exploring the Syntactic Abilities of RNNs with Multi-task
                  Learning</a>. In <i>Proceedings of the 21st Conference on Computational Natural Language Learning
                  (CoNLL 2017)</i>, pages 3–14, Vancouver, Canada. Association for Computational
                Linguistics.</span><button type=button class="btn btn-clipboard btn-secondary btn-sm d-none ml-2"
                data-clipboard-target=#citeACL><i class="far fa-clipboard"></i></button></dd>
            <dt>Cite (Informal):</dt>
            <dd><span id=citeRichText><a href=https://aclanthology.org/K17-1003>Exploring the Syntactic Abilities of
                  RNNs with Multi-task Learning</a> (Enguehard et al., CoNLL 2017)</span><button type=button
                class="btn btn-clipboard btn-secondary btn-sm d-none ml-2" data-clipboard-target=#citeRichText><i
                  class="far fa-clipboard"></i></button></dd>
            <dt class=acl-button-row>Copy Citation:</dt>
            <dd class=acl-button-row><button type=button class="btn btn-clipboard-outside btn-secondary btn-sm d-none"
                data-clipboard-target=#citeMarkdownContent><i class="far fa-clipboard pr-2"></i>Markdown</button>
              <button type=button class="btn btn-secondary btn-sm" data-toggle=modal data-target=#citeModal>More
                options…</button>
            </dd>
            <dt>PDF:</dt>
            <dd><a
                href=https://preview.aclanthology.org/autopr/K17-1003.pdf>https://preview.aclanthology.org/autopr/K17-1003.pdf</a>
            </dd>
            <dt>Code</dt>
            <dd><a href=https://github.com/emengd/multitask-agreement><i
                  class="fab fa-github"></i>&nbsp;emengd/multitask-agreement</a></dd>
            <dt>Data</dt>
            <dd><a href=https://paperswithcode.com/dataset/penn-treebank>Penn Treebank</a></dd>
        </div>
        <div class=acl-paper-link-block><a class="btn btn-primary"
            href=https://preview.aclanthology.org/autopr/K17-1003.pdf
            title="Open PDF of 'Exploring the Syntactic Abilities of RNNs with Multi-task Learning'"><i
              class="far fa-file-pdf"></i><span class=pl-2>PDF</span></a>
          <a class="btn btn-secondary"
            href="https://www.semanticscholar.org/search?q=Exploring+the+Syntactic+Abilities+of+RNNs+with+Multi-task+Learning"
            title="Search for 'Exploring the Syntactic Abilities of RNNs with Multi-task Learning' on Semantic Scholar"><i
              class="ai ai-semantic-scholar"></i><span class="pl-sm-2 d-none d-sm-inline">Search</span></a>
          <a class="btn btn-secondary d-flex flex-wrap justify-content-center"
            href="https://paperswithcode.com/paper/?acl=K17-1003"
            title="Code for 'Exploring the Syntactic Abilities of RNNs with Multi-task Learning' on Papers with Code"><svg
              xmlns="http://www.w3.org/2000/svg" class="pwc-icon-big" viewBox="0 0 512 512">
              <path stroke="#4d8093" fill="#4d8093"
                d="M88 128h48v256H88zm144 0h48v256h-48zm-72 16h48v224h-48zm144 0h48v224h-48zm72-16h48v256h-48z" />
              <path stroke="#4d8093" fill="#4d8093"
                d="M104 104V56H16v4e2h88v-48H64V104zM408 56v48h40v304h-40v48h88V56z" />
            </svg><span class="pl-sm-2 d-none d-sm-inline">Code</span></a>
            <a class="btn btn-warning d-flex flex-wrap justify-content-center" href=# title="Correct problems with title, author list, and abstract" onclick="showMetadataDialog()">
              <span class="pl-sm-2 d-none d-sm-inline"><i class="fas fa-edit"></i></span>
              <span class="px-1">Fix metadata</span>
            </a>
          </div>
      </div>
      <hr>
      <div class="modal fade" id=citeModal tabindex=-1 role=dialog aria-labelledby=citeModalLabel aria-hidden=true>
        <div class="modal-dialog modal-lg" role=document>
          <div class=modal-content>
            <div class=modal-header>
              <h5 class=modal-title id=citeModalLabel>Export citation</h5><button class=close data-dismiss=modal
                aria-label=Close>
                <span aria-hidden=true>&#215;</span></button>
            </div>
            <div class=modal-body>
              <ul class="nav nav-tabs mb-2" id=citeFormats role=tablist>
                <li class=nav-item><a class="nav-link disabled" data-toggle=list href=#citeBibtex role=tab
                    aria-controls=citeBibtex aria-selected=false>BibTeX</a></li>
                <li class=nav-item><a class="nav-link disabled" data-toggle=list href=#citeMods role=tab
                    aria-controls=citeMods aria-selected=false>MODS XML</a></li>
                <li class=nav-item><a class="nav-link disabled" data-toggle=list href=#citeEndnote role=tab
                    aria-controls=citeEndnote aria-selected=false>Endnote</a></li>
                <li class=nav-item><a class="nav-link active" data-toggle=list href=#citeMarkdown role=tab
                    aria-controls=citeMarkdown aria-selected=true>Preformatted</a></li>
              </ul>
              <div class=tab-content id=citeFormatsContent>
                <div class="tab-pane active" id=citeBibtex role=tabpanel></div>
                <div class=tab-pane id=citeMods role=tabpanel></div>
                <div class=tab-pane id=citeEndnote role=tabpanel></div>
                <div class=tab-pane id=citeMarkdown role=tabpanel>
                  <h5>Markdown (Informal)</h5>
                  <p id=citeMarkdownContent class="text-monospace small bg-light border p-2">[Exploring the Syntactic
                    Abilities of RNNs with Multi-task Learning](https://aclanthology.org/K17-1003) (Enguehard et al.,
                    CoNLL 2017)</p>
                  <ul class=mt-2>
                    <li><a href=https://aclanthology.org/K17-1003>Exploring the Syntactic Abilities of RNNs with
                        Multi-task Learning</a> (Enguehard et al., CoNLL 2017)</li>
                  </ul>
                  <h5>ACL</h5>
                  <ul class=mt-2>
                    <li id=citeACLstyleContent>Émile Enguehard, Yoav Goldberg, and Tal Linzen. 2017. <a
                        href=https://aclanthology.org/K17-1003>Exploring the Syntactic Abilities of RNNs with Multi-task
                        Learning</a>. In <i>Proceedings of the 21st Conference on Computational Natural Language
                        Learning (CoNLL 2017)</i>, pages 3–14, Vancouver, Canada. Association for Computational
                      Linguistics.</li>
                  </ul>
                  <div class="modal-footer pb-1"><button type=button class="btn btn-clipboard btn-primary d-none"
                      data-clipboard-target=#citeMarkdownContent><i class="far fa-clipboard pr-2"></i>Copy Markdown to
                      Clipboard</button>
                    <button type=button class="btn btn-clipboard btn-primary d-none"
                      data-clipboard-target=#citeACLstyleContent><i class="far fa-clipboard pr-2"></i>Copy ACL to
                      Clipboard</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
  <footer class="bg-gradient-light py-2 py-xl-3 mt-3 mt-md-4 mt-xl-5">
    <div class=container>
      <p class="text-muted small px-1"><span class="float-right mt-2 ml-2"><a rel=license
            href=http://creativecommons.org/licenses/by/4.0 /><img alt="Creative Commons License" style=border-width:0
            src=https://i.creativecommons.org/l/by/4.0/88x31.png></a></span>
        ACL materials are Copyright ©&nbsp;1963&ndash;2024 ACL; other materials are copyrighted by their respective
        copyright holders. Materials prior to 2016 here are licensed under the <a
          href=https://creativecommons.org/licenses/by-nc-sa/3.0 />Creative Commons Attribution-NonCommercial-ShareAlike
        3.0 International License</a>. Permission is granted to make copies for the purposes of teaching and research.
        Materials published in or after 2016 are licensed on a <a
          href=https://creativecommons.org/licenses/by/4.0 />Creative Commons Attribution 4.0 International License</a>.
      </p>
      <p class="text-muted small px-1">The ACL Anthology is managed and built by the <a href=/autopr/info/credits />ACL
        Anthology team</a> of volunteers.</p>
      <p class="text-muted small px-1"><i>Site last built on 11 December 2024 at 16:44 UTC with <a
            href=https://github.com/acl-org/acl-anthology/tree/6831fe17fea3f63388337a84773a181af4d3f759>commit
            6831fe17</a>.</i></p>
    </div>
  </footer>
  <script src=https://code.jquery.com/jquery-3.3.1.slim.min.js
    integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script>
  <script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js
    integrity=sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut crossorigin=anonymous></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>$(function () { $('[data-toggle="tooltip"]').tooltip(), $("#toggle-all-abstracts") && ($("#toggle-all-abstracts").click(function () { var e = $("#toggle-all-abstracts"); e.attr("disabled", !0), e.attr("data-toggle-state") == "hide" ? ($(".abstract-collapse").collapse("show"), e.attr("data-toggle-state", "show")) : ($(".abstract-collapse").collapse("hide"), e.attr("data-toggle-state", "hide")), e.attr("disabled", !1) }), $("#toggle-all-abstracts").attr("disabled", !1)) })</script>
  <script src=autopr/js/clipboard.min.js></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script>$(document).ready(function () { if (ClipboardJS.isSupported()) { success_fn = function (e) { var t = $(e.trigger); t.toggleClass("btn-success"), t.children("i").toggleClass("far fa-clipboard fas fa-clipboard-check"), e.clearSelection(), setTimeout(function () { t.toggleClass("btn-success"), t.children("i").toggleClass("far fa-clipboard fas fa-clipboard-check") }, 2e3) }; var e, t = new ClipboardJS(".btn-clipboard"); t.on("success", success_fn), $(".btn-clipboard").removeClass("d-none"), e = new ClipboardJS(".btn-clipboard-outside", { text: function (e) { var t = e.getAttribute("data-clipboard-target"); return $(t).text() } }), e.on("success", success_fn), $(".btn-clipboard-outside").removeClass("d-none") } })

  const paper_params = {
    anthology_id: "K17-1003",
    title: "Exploring the Syntactic Abilities of <fixed-case>RNN</fixed-case>s with Multi-task Learning",
    authors: [
      {"first": "Émile", "last": "Enguehard", "affiliation": ""},
      {"first": "Yoav", "last": "Goldberg", "affiliation": ""},
      {"first": "Tal", "last": "Linzen", "affiliation": ""}
    ],
    abstract: "Recent work has explored the syntactic abilities of RNNs using the subject-verb agreement task, which diagnoses sensitivity to sentence structure. RNNs performed this task well in common cases, but faltered in complex sentences (Linzen et al., 2016). We test whether these errors are due to inherent limitations of the architecture or to the relatively indirect supervision provided by most agreement dependencies in a corpus. We trained a single RNN to perform both the agreement task and an additional task, either CCG supertagging or language modeling. Multi-task training led to significantly lower error rates, in particular on complex sentences, suggesting that RNNs have the ability to evolve more sophisticated syntactic representations than shown before. We also show that easily available agreement training data can improve performance on other syntactic tasks, in particular when only a limited amount of training data is available for those tasks. The multi-task paradigm can also be leveraged to inject grammatical knowledge into language models."
  };

// Initial authors data
function showMetadataDialog() {
  // Populate the modal with current values
  document.getElementById("paperIdSpan").textContent = paper_params.anthology_id;
  document.getElementById("paperTitle").value = paper_params.title;
  document.getElementById("paperAbstract").value = paper_params.abstract;

  const container = document.getElementById("authorsContainer");
  container.innerHTML = "";
  paper_params.authors.forEach((author, idx) => {
    container.appendChild(createAuthorRow(author.first, author.last, author.affiliation));
  });

  const modal = new bootstrap.Modal(document.getElementById('metadataModal'));
  modal.show();
}
</script>

<script>
  // Just call Sortable on your container after you’ve populated it:
  new Sortable(document.getElementById('authorsContainer'), {
    animation: 150, // a nice animation
    // handle: '.drag-handle', // if you have a handle
    ghostClass: 'sortable-ghost'
  });
  </script>

<script>
  // Dragstart: store the element being dragged
  authorsContainer.addEventListener('dragstart', (e) => {
    const row = e.target.closest('.author-row');
    if (row) {
      draggedElement = row;
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/plain', 'reordering'); // required to initiate drag
    }
  });

  // Dragover: allow drop
  authorsContainer.addEventListener('dragover', (e) => {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
  });

  // Drop: Insert the dragged element before the hovered row if found
  authorsContainer.addEventListener('drop', (e) => {
    e.preventDefault();
    const targetRow = e.target.closest('.author-row');
    if (targetRow && targetRow !== draggedElement) {
      authorsContainer.insertBefore(draggedElement, targetRow);
    } else if (!targetRow) {
      // If dropped outside any specific row, append to the end
      authorsContainer.appendChild(draggedElement);
    }
    draggedElement = null;
  });

function createAuthorRow(first, last, affiliation) {
  // Create the overall row (using Bootstrap classes for spacing).
  const row = document.createElement('div');
  row.className = 'author-row row g-2 mb-2';
  // Make the entire row draggable.
  row.draggable = true;
  row.ondragstart = dragAuthor;

  // --- First name + handle ---
  // We use a position-relative column so we can absolutely-position the handle.
  const firstNameCol = document.createElement('div');
  firstNameCol.className = 'col-12 col-md-3 position-relative';

  // The drag handle (⋮) is positioned over the left edge of the input.
  const handle = document.createElement('span');
  handle.className = 'drag-handle position-absolute top-50 translate-middle-y';
  // You could tweak left margins (e.g., left: 0.25rem) to space it out more cleanly.
  handle.style.left = '0.5rem';
  handle.style.cursor = 'grab';
  handle.textContent = '⋮';

  const firstName = document.createElement('input');
  firstName.type = 'text';
  firstName.className = 'form-control ps-4'; // add left padding so text doesn't overlap the handle
  firstName.placeholder = 'First name';
  firstName.value = first;

  firstNameCol.appendChild(handle);
  firstNameCol.appendChild(firstName);

  // --- Last name ---
  const lastNameCol = document.createElement('div');
  lastNameCol.className = 'col-12 col-md-3';

  const lastNameInput = document.createElement('input');
  lastNameInput.type = 'text';
  lastNameInput.className = 'form-control';
  lastNameInput.placeholder = 'Last name';
  lastNameInput.value = last;

  lastNameCol.appendChild(lastNameInput);

  // --- Affiliation ---
  const affCol = document.createElement('div');
  affCol.className = 'col-12 col-md-3';

  const affInput = document.createElement('input');
  affInput.type = 'text';
  affInput.className = 'form-control';
  affInput.placeholder = 'Affiliation';
  affInput.value = affiliation;

  affCol.appendChild(affInput);

  // --- Delete button ---
  const delCol = document.createElement('div');
  delCol.className = 'col-12 col-md-1 text-end';

  const delBtn = document.createElement('button');
  delBtn.type = 'button';
  delBtn.className = 'btn btn-sm btn-danger';
  delBtn.textContent = 'X';
  delBtn.onclick = () => row.remove();

  delCol.appendChild(delBtn);

  // --- Assemble the row ---
  row.appendChild(firstNameCol);
  row.appendChild(lastNameCol);
  row.appendChild(affCol);
  row.appendChild(delCol);

  return row;
}

  // function createAuthorRow(first, last, affiliation) {
  //   // Create the container for the entire row
  //   const row = document.createElement('div');
  //   row.className = 'row g-2 mb-2 author-row';
  //   row.draggable = true;
  //   row.ondragstart = dragAuthor;

  //   // First name column
  //   const firstNameCol = document.createElement('div');
  //   firstNameCol.className = 'col-3';

  //   const firstName = document.createElement('input');
  //   firstName.type = 'text';
  //   firstName.placeholder = 'First name';
  //   firstName.className = 'form-control';
  //   firstName.value = first;

  //   firstNameCol.appendChild(firstName);

  //   // Last name column
  //   const lastNameCol = document.createElement('div');
  //   lastNameCol.className = 'col-3';

  //   const lastName = document.createElement('input');
  //   lastName.type = 'text';
  //   lastName.placeholder = 'Last name';
  //   lastName.className = 'form-control';
  //   lastName.value = last;

  //   lastNameCol.appendChild(lastName);

  //   // Affiliation column
  //   const affCol = document.createElement('div');
  //   affCol.className = 'col-3';

  //   const affInput = document.createElement('input');
  //   affInput.type = 'text';
  //   affInput.placeholder = 'Affiliation';
  //   affInput.className = 'form-control';
  //   affInput.value = affiliation;

  //   affCol.appendChild(affInput);

  //   // Delete button column
  //   const delCol = document.createElement('div');
  //   delCol.className = 'col-1 text-end';

  //   const delBtn = document.createElement('button');
  //   delBtn.type = 'button';
  //   delBtn.className = 'btn btn-sm btn-danger';
  //   delBtn.textContent = 'X';
  //   delBtn.onclick = () => row.remove();

  //   delCol.appendChild(delBtn);

  //   // Append all columns to the row
  //   // row.appendChild(handleCol);
  //   row.appendChild(firstNameCol);
  //   row.appendChild(lastNameCol);
  //   row.appendChild(affCol);
  //   row.appendChild(delCol);

  //   return row;
  // }

  function addAuthor() {
    const container = document.getElementById('authorsContainer');
    container.appendChild(createAuthorRow("", "", ""));
  }

  // Drag & Drop functions for authors
  let draggedAuthor = null;
  function dragAuthor(ev) {
    ev.dataTransfer.setData('text/plain', '');
    draggedAuthor = ev.currentTarget;
  }
  function allowDrop(ev) {
    ev.preventDefault();
  }
  function dropAuthor(ev) {
    ev.preventDefault();
    if (ev.target.id === "authorsContainer" || ev.target.parentNode.id === "authorsContainer") {
      const container = document.getElementById("authorsContainer");
      // Insert before the target row if we dropped on a row, otherwise at the end
      if (ev.target.classList && ev.target.classList.contains('author-row')) {
        container.insertBefore(draggedAuthor, ev.target);
      } else if (ev.target.parentNode.classList && ev.target.parentNode.classList.contains('author-row')) {
        container.insertBefore(draggedAuthor, ev.target.parentNode);
      } else {
        container.appendChild(draggedAuthor);
      }
    }
  }

  // New function to handle submission
  function submitMetadataCorrection() {
    const newTitle = document.getElementById("paperTitle").value;
    const newAbstract = document.getElementById("paperAbstract").value;

    const authorRows = document.querySelectorAll("#authorsContainer .author-row");
    const newAuthors = [];
    authorRows.forEach(row => {
      const inputs = row.querySelectorAll("input");
      newAuthors.push({
        "first": inputs[0].value,
        "last": inputs[1].value,
        "affiliation": inputs[2].value
      });
    });

    const updatedParams = {}

    // add title if it changed
    if (newTitle !== paper_params.title) {
      updatedParams.title = newTitle;
    }
    // add abstract if it changed
    if (newAbstract !== paper_params.abstract) {
      updatedParams.abstract = newAbstract;
    }
    // add authors if they changed
    if (JSON.stringify(newAuthors) !== JSON.stringify(paper_params.authors)) {
      updatedParams.authors = newAuthors;
    }

    if (Object.keys(updatedParams).length === 0) {
      alert("No changes detected.");
      return;
    }

    // Same assembly as original code
    const baseurl = "https://github.com/acl-org/acl-anthology/issues/new?template=99-bulk-metadata-correction.yml";
    const issue_title = `Metadata correction for ${updatedParams.anthology_id}`;
    const labels = "metadata,correction";
    const who = "anthology-assist";
    const param_string = "```json\n" + JSON.stringify(updatedParams, null, 2) + "\n```";

    const url = baseurl + `&title=${encodeURIComponent(issue_title)}&assignee=${encodeURIComponent(who)}&labels=${encodeURIComponent(labels)}&data=` + encodeURIComponent(param_string);

    window.open(url, "_blank");
  }
  </script>
</body>
</html>
