{{ $collection_id := index (split .Params.anthology_id "-") 0 }}
{{ $paper := index (index $.Site.Data.papers $collection_id) .Params.anthology_id }}
<div class="d-sm-flex align-items-stretch mb-3">
  <div class="d-block me-2 list-button-row">
    <span class="d-inline d-sm-block text-nowrap">
      {{- with $paper.pdf -}}
      <a class="badge text-bg-primary align-middle me-1" href="{{ . }}" data-bs-toggle="tooltip" data-bs-placement="top" title="Open PDF" aria-label="Open PDF">
        pdf
      </a>
      {{- end -}}
      {{- if (fileExists (printf "/data-export/volumes/%s.bib" $paper.parent_volume_id)) -}}
      <a class="badge text-bg-secondary align-middle me-1" href="{{ (printf "%s.bib" .Params.anthology_id) | relURL }}" data-bs-toggle="tooltip" data-bs-placement="top" title="Export to BibTeX" aria-label="Export to BibTeX">
        bib
      </a>
      {{- end -}}
      {{- with $paper.abstract_html -}}
      <a class="badge text-bg-info align-middle me-1" href="#abstract-{{ replace $.Params.anthology_id "." "--" }}" data-bs-toggle="collapse" aria-expanded="false"  aria-controls="abstract-{{ replace $.Params.anthology_id "." "--" }}" title="Show Abstract" aria-label="Show Abstract">abs</a>
      {{- end -}}
    </span>
    <span class="d-inline d-sm-block text-nowrap">
      {{- range $paper.award -}}
      <span class="align-middle me-1" data-bs-toggle=tooltip data-bs-placement=bottom title="{{ . }}"><i class="fas fa-award"></i></span>
      {{- end -}}
      {{- range $paper.attachment -}}
        <a class="badge text-bg-attachment align-middle me-1" href="{{ .url }}" data-bs-toggle="tooltip" data-bs-placement="top" title="{{ .type | humanize }}" aria-label="Open {{ .type | humanize }}">{{ partial "attachment_repr.html" . }}</a>
      {{- end -}}
      {{- range $paper.video -}}
      <a class="badge text-bg-attachment align-middle me-1" href="{{ . }}" data-bs-toggle="tooltip" data-bs-placement="top" title="Video" aria-label="Open Video"><i class="fas fa-video"></i></a>
      {{- end -}}
    </span>
  </div>
  <span class="d-block">
    {{ if eq hugo.Environment "development" }}
      <span class="badge text-bg-light align-middle">{{ .Params.anthology_id }}</span>
    {{ end }}
    <strong><a class="align-middle" href="{{ .RelPermalink }}">{{ $paper.title_html | safeHTML }}</a></strong>
    <br />
    {{ with $paper.author }}
      {{ $len := (len $paper.author) }}
      {{ range $index, $person := $paper.author }}
        {{ partial "author_link.html" (dict "ctx" $ "person" $person) }}
        {{ if ne (add $index 1) $len }} | {{ end }}
      {{ end }}
    {{ end }}
    <br />
    {{- with $paper.parent_volume_id -}}
    {{ $volume := index $.Site.Data.volumes . }}
    {{ $volume_page := printf "/volumes/%s" . }}
    <a href="{{ relref $ $volume_page }}" class="text-muted">{{ $volume.title }}</a>
    {{- end -}}
  </span>
</div>

{{ with $paper.abstract_html }}
<div class="card bg-light mb-2 mb-lg-3 collapse abstract-collapse" id="abstract-{{ replace $.Params.anthology_id "." "--" }}">
  <div class="card-body p-3 small">
    {{ . | safeHTML }}
  </div>
</div>
{{ end }}
