{{ define "main" }}
<div class="row justify-content-center">
  <div class="col-12 col-xl-10 col-xl-width-auto">
    <div class="jumbotron">
      {{- $.Scratch.Set "paper_count" 0 -}}
      {{- range $.Site.Data.papers -}}
      {{- $.Scratch.Add "paper_count" (len .) -}}
      {{- end -}}
      <h2 id="title" class="ms-2">Welcome to the ACL Anthology</h2>

      <aside class="card font-weight-light acl-greeting">
        <div class="card-body">
          The ACL Anthology currently hosts {{ $.Scratch.Get "paper_count" }} papers on the study of computational
          linguistics and natural language processing.
        </div>
        <div class="card-body">
          <a href="http://groups.google.com/group/acl-anthology?hl=en">Subscribe to the mailing list</a> or the <a
            href="{{ "posts/index.xml" | relURL }}">RSS news feed</a> to receive announcements and updates to the
          Anthology.
        </div>
      </aside>
    </div>

    {{ range first 1 (where .Site.RegularPages "Type" "posts") }}
      <aside class="alert alert-info alert-dismissible acl-news" role="alert">
        <div class="acl-news-date">{{ .PublishDate.Format "January 2006" }}</div>
        {{ .Content }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </aside>

      <main aria-role="main">
      {{/* ACL EVENTS */}}
      {{/* Hardcoded range of years because the table layout depends on it */}}
      {{/* Get the current year */}}
      {{ $current_year := now.Format "2006" | int }}
      {{/* The number of columns needed for the current year block */}}
      {{ $num_cols := add (mod $current_year 10) 1 }}
      {{ $all_years := seq $current_year -1 1974 }}
      {{/* Years that should have a border on their left-hand side */}}
      {{ $border_years := slice (printf "%d" $current_year) "2019" "2009" "1999" "1989" }}

      <div class="acl-event-table">
        <div class="acl-row-block">
          <div class="acl-row-th border-bottom">Venue</div>
          {{ range $venue := sort $.Site.Data.venues "slug" "asc" }}
          {{ if (and $venue.is_toplevel $venue.is_acl) }}
            {{ $venue_page := $.Site.GetPage (printf "/venues/%s" $venue.slug) }}
            {{ $acronym := $venue.acronym }}
            <div class="acl-row-th">
              <a href="{{ relref $ (printf "/venues/%s" $venue.slug) }}">{{ $acronym }}</a>
            </div>
          {{ end }}
          {{ end }}
          <div class="acl-row-th">SIGs</div>
        </div><div class="acl-row-block">
          <div class="acl-col-th border-bottom acl-colspan-{{ $num_cols }}">{{ $current_year }} &ndash; 2020</div>
          {{ range $venue := sort $.Site.Data.venues "slug" "asc" }}
          {{ if (and $venue.is_toplevel $venue.is_acl) }}
            {{ range $all_years }}
            {{ $year := string . }}
            {{ $event := printf "%s-%s" $venue.slug $year }}
                <div class="acl-td {{ cond (in $border_years $year) "border-start" "" }}">
                  {{ with index $venue "volumes_by_year" $year }}
                  <a href="{{ relref $ (printf "/events/%s-%s" $venue.slug $year) }}">
                    {{ slicestr $year 2 4 }}
                  </a>
                  {{ end }}
                </div>
                {{- if (in $border_years $year) -}}
              </div>
              <div class="acl-row-block"> {{/* start a new block */}}
                {{- end -}}
                {{- end -}}
              </div>
          {{ end }}
          {{ end }}
          <div class="acl-td border-left acl-colspan-{{ len $all_years }}">
          {{ $sig_pages := (where $.Site.RegularPages "Section" "sigs").ByParam "short_acronym" }}
          {{ $len := len $sig_pages }}
          {{ range $index, $page := $sig_pages}}
            <a href="{{ $page.RelPermalink }}">{{ $page.Params.short_acronym }}</a>{{ if ne (add $index 1) $len }} | {{ end }}
          {{ end }}
          </div>
        </div>
      </div>

      <br/>

      {{/* NON-ACL EVENTS */}}
      {{/* Hardcoded range of years because the table layout depends on it */}}
      {{/* Adjust this range at the beginning of each year */}}
      {{ $all_years := seq $current_year -1 1986 | append (slice 1984 1982 1980 1978 1975 1973 1969 1967 1965) }}
      {{/* Years that should have a border on their left-hand side */}}
      {{ $border_years := slice (printf "%d" $current_year) "2019" "2009" "1999" "1989" }}

      <div class="acl-event-table">
        <div class="acl-row-block">
          <div class="acl-row-th border-bottom">Venue</div>
          {{ range $venue := sort $.Site.Data.venues "slug" "asc" }}
          {{ if (and $venue.is_toplevel (not $venue.is_acl)) }}
            {{ $venue_page := $.Site.GetPage (printf "/venues/%s" $venue.slug) }}
            {{ $acronym := $venue.acronym }}
            <div class="acl-row-th">
              <a href="{{ relref $ (printf "/venues/%s" $venue.slug) }}">{{ $acronym }}</a>
            </div>
          {{ end }}
          {{ end }}
        </div><div class="acl-row-block">
          <div class="acl-col-th border-bottom acl-colspan-{{ $num_cols }}">{{ $current_year }} &ndash; 2020</div>
          {{ range $venue := sort $.Site.Data.venues "slug" "asc" }}
          {{ if (and $venue.is_toplevel (not $venue.is_acl)) }}
            {{ range $all_years }}
            {{ $year := string . }}
            {{ $event := printf "%s-%s" $venue.slug $year }}
                <div class="acl-td {{ cond (in $border_years $year) "border-start" "" }}">
                  {{ with index $venue "volumes_by_year" $year }}
                  <a href="{{ relref $ (printf "/events/%s-%s" $venue.slug $year) }}">
                    {{ slicestr $year 2 4 }}
                  </a>
                  {{ end }}
                </div>
                {{- if (in $border_years $year) -}}
              </div>
              <div class="acl-row-block"> {{/* start a new block */}}
                {{- end -}}
                {{- end -}}
              </div>
          {{ end }}
          {{ end }}
        </div>
      </div>
      </main>
    {{ end }}
  </div>
</div>
{{ end }}